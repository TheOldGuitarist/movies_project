<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="container mt-5">

  <!-- ===================== DIRECTORS ===================== -->
  <h2 class="mb-4">Directors</h2>
  <table class="table table-bordered table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Nationality</th>
        <th>Age</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for d in directors %}
      <tr>
        <td>{{ d.id }}</td>
        <td>{{ d.name }}</td>
        <td>{{ d.nationality }}</td>
        <td>{{ d.age }}</td>
        <td>{{ d.active|yesno:"Yes,No" }}</td>
        <td>
          <a href="#" class="text-primary me-2" data-bs-toggle="modal" data-bs-target="#editDirectorModal{{ d.id }}">
            <i class="bi bi-pencil"></i>
          </a>
          <a href="{% url 'delete_director' d.id %}" class="text-danger">
            <i class="bi bi-trash"></i>
          </a>
        </td>
      </tr>

      <!-- Modal Edit Director -->
      <div class="modal fade" id="editDirectorModal{{ d.id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post" action="{% url 'edit_director' d.id %}">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title">Edit Director</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="text" name="name" value="{{ d.name }}" class="form-control mb-2">
                <input type="text" name="nationality" value="{{ d.nationality }}" class="form-control mb-2">
                <input type="number" name="age" value="{{ d.age }}" class="form-control mb-2">
                <div class="form-check">
                  <input type="checkbox" class="form-check-input" name="active" {% if d.active %}checked{% endif %}>
                  <label class="form-check-label">Active</label>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}

      <!-- Add Director row -->
      <tr>
        <form method="post">
          {% csrf_token %}
          <td>—</td>
          <td><input type="text" name="name" class="form-control" placeholder="Name"></td>
          <td><input type="text" name="nationality" class="form-control" placeholder="Nationality"></td>
          <td><input type="number" name="age" class="form-control" placeholder="Age"></td>
          <td class="text-center"><input type="checkbox" name="active" checked></td>
          <td><button type="submit" name="add_director" class="btn btn-primary btn-sm">Save</button></td>
        </form>
      </tr>
    </tbody>
  </table>

  <hr class="my-5">

  <!-- ===================== MOVIES ===================== -->
  <h2 class="mb-4">Movies</h2>
  <table class="table table-bordered table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>Id</th>
        <th>Name</th>
        <th>Release Year</th>
        <th>Gender</th>
        <th>Duration</th>
        <th>Director</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for m in movies %}
      <tr>
        <td>{{ m.id }}</td>
        <td>{{ m.name }}</td>
        <td>{{ m.release_year }}</td>
        <td>{{ m.gender }}</td>
        <td>
          {% if m.duration %}
            {{ m.duration }}  <!-- timedelta mostrado como HH:MM:SS -->
          {% else %}
            —
          {% endif %}
        </td>
        <td>{{ m.fk_director.name }}</td>
        <td>
          <a href="#" class="text-primary me-2" data-bs-toggle="modal" data-bs-target="#editMovieModal{{ m.id }}">
            <i class="bi bi-pencil"></i>
          </a>
          <a href="{% url 'delete_movie' m.id %}" class="text-danger">
            <i class="bi bi-trash"></i>
          </a>
        </td>
      </tr>

      <!-- Modal Edit Movie -->
      <div class="modal fade" id="editMovieModal{{ m.id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post" action="{% url 'edit_movie' m.id %}">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title">Edit Movie</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="text" name="name" value="{{ m.name }}" class="form-control mb-2">
                <input type="date" name="release_year" value="{{ m.release_year|date:'Y-m-d' }}" class="form-control mb-2">
                <input type="text" name="gender" value="{{ m.gender }}" class="form-control mb-2">
                <!-- DurationField como texto HH:MM:SS -->
                <input type="text" name="duration" value="{{ m.duration }}" class="form-control mb-2" placeholder="HH:MM:SS">
                <select name="fk_director" class="form-control">
                  {% for d in directors %}
                  <option value="{{ d.id }}" {% if m.fk_director.id == d.id %}selected{% endif %}>{{ d.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}

      <!-- Add Movie row -->
      <tr>
        <form method="post">
          {% csrf_token %}
          <td>—</td>
          <td><input type="text" name="name" class="form-control" placeholder="Name"></td>
          <td><input type="date" name="release_year" class="form-control"></td>
          <td><input type="text" name="gender" class="form-control" placeholder="Genre"></td>
          <td><input type="text" name="duration" class="form-control" placeholder="HH:MM:SS"></td>
          <td>
            <select name="fk_director" class="form-control">
              {% for d in directors %}
              <option value="{{ d.id }}">{{ d.name }}</option>
              {% endfor %}
            </select>
          </td>
          <td><button type="submit" name="add_movie" class="btn btn-primary btn-sm">Save</button></td>
        </form>
      </tr>
    </tbody>
  </table>

</body>
</html>
